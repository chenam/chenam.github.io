{"title":"移动端图片上传-踩坑小记","date":"2019-01-23T06:01:53.000Z","slug":"移动端图片上传-踩坑小记","tags":["javascript"],"categories":["web前端"],"updated":"2019-01-23T06:03:32.414Z","content":"<blockquote>\n<p>用原生的input 实现图片上传 ，还有一些兼容性问题。比如说安卓很多机型只能调用相册，调不了照相机。安卓有些机型的获取不到file.type的值</p>\n</blockquote>\n<p>话不多说，上代码<br><figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">&lt;input id=&quot;fileInput&quot; type=&quot;file&quot; accept=&quot;image/*&quot; class=&quot;el-upload__input&quot;  @change=&quot;fileChange&quot;/&gt;</span><br></pre></td></tr></table></figure></p>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">fileChange()&#123;</span><br><span class=\"line\">    const self = this;</span><br><span class=\"line\">    var file = e.target.files[0];</span><br><span class=\"line\">    var formData = new FormData();</span><br><span class=\"line\">    var reader = new FileReader();</span><br><span class=\"line\">    var image = new Image();</span><br><span class=\"line\">    if(file)&#123;</span><br><span class=\"line\">        var type = file.type;</span><br><span class=\"line\">        // alert(e.target);</span><br><span class=\"line\">        if(!/image\\/\\w+/.test(type))&#123;</span><br><span class=\"line\">            Toast(&apos;上传类型错误&apos;);</span><br><span class=\"line\">            document.getElementById(&apos;fileInput&apos;).value = &apos;&apos;;</span><br><span class=\"line\">        &#125;else if(file.size &gt; 1024*1024*5)&#123;</span><br><span class=\"line\">            Toast(&apos;上传图片不能大于5M&apos;);</span><br><span class=\"line\">            document.getElementById(&apos;fileInput&apos;).value = &apos;&apos;;</span><br><span class=\"line\">        &#125;else&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">            formData.append(&apos;fileItem&apos;, file);</span><br><span class=\"line\">            axios.post(&apos;XXXX&apos;, formData, &#123;</span><br><span class=\"line\">                method: &apos;post&apos;,</span><br><span class=\"line\">                headers: &#123;&apos;Content-Type&apos;: &apos;multipart/form-data&apos;&#125;</span><br><span class=\"line\">            &#125;).then((res) =&gt; &#123;</span><br><span class=\"line\">                var obj = res.data;</span><br><span class=\"line\">                if(obj.success)&#123;</span><br><span class=\"line\">                    document.getElementById(&apos;fileInput&apos;).value = &apos;&apos;;</span><br><span class=\"line\">                &#125;else&#123;</span><br><span class=\"line\">                &#125;;</span><br><span class=\"line\">            &#125;).catch((error) =&gt; &#123;</span><br><span class=\"line\">            &#125;);</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","prev":{"title":"深拷贝 && 浅拷贝","slug":"深拷贝-浅拷贝"},"next":{"title":"React-quill-初体验","slug":"React-quill-初体验"},"link":"http://yoursite.com/post/移动端图片上传-踩坑小记/"}