{"title":"React-quill-初体验","date":"2019-01-23T02:54:14.000Z","slug":"React-quill-初体验","tags":["javascript"],"categories":["web前端"],"updated":"2019-01-23T02:57:26.574Z","content":"<h3 id=\"用的是react-quill-颜值如图\"><a href=\"#用的是react-quill-颜值如图\" class=\"headerlink\" title=\"用的是react-quill , 颜值如图\"></a>用的是react-quill , 颜值如图</h3><div class=\"article-img\"><p><img src=\"../images/sck-f.png\" alt=\"图片\"></p></div>\n<h3 id=\"使用方法\"><a href=\"#使用方法\" class=\"headerlink\" title=\"使用方法\"></a>使用方法</h3><ul>\n<li>引入</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">npm install react-quill --save</span><br><span class=\"line\"></span><br><span class=\"line\">import ReactQuill from &apos;react-quill&apos;; </span><br><span class=\"line\">import &apos;react-quill/dist/quill.snow.css&apos;;</span><br></pre></td></tr></table></figure>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br></pre></td><td class=\"code\"><pre><span class=\"line\">// 富文本的记录</span><br><span class=\"line\">handleChange(value)&#123;</span><br><span class=\"line\">    this.setState(&#123;</span><br><span class=\"line\">        richValue : value</span><br><span class=\"line\">    &#125;)</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 富文本toolbar</span><br><span class=\"line\">const modules = &#123;</span><br><span class=\"line\">    // theme: &apos;snow&apos;,</span><br><span class=\"line\">    toolbar: &#123;</span><br><span class=\"line\">        container: [</span><br><span class=\"line\">            [&apos;bold&apos;, &apos;italic&apos;, &apos;underline&apos;, &apos;strike&apos;, &apos;blockquote&apos;],</span><br><span class=\"line\">            [&#123;&apos;list&apos;: &apos;ordered&apos;&#125;, &#123;&apos;list&apos;: &apos;bullet&apos;&#125;, &#123;&apos;indent&apos;: &apos;-1&apos;&#125;, &#123;&apos;indent&apos;: &apos;+1&apos;&#125;],</span><br><span class=\"line\">            [&apos;link&apos;, &apos;image&apos;],</span><br><span class=\"line\">            [&apos;clean&apos;]</span><br><span class=\"line\">        ],</span><br><span class=\"line\">        handlers: &#123;</span><br><span class=\"line\">            &apos;image&apos;: self.imageHandler</span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    </span><br><span class=\"line\">&#125;;</span><br><span class=\"line\"></span><br><span class=\"line\">&lt;ReactQuill </span><br><span class=\"line\">    value=&#123;richValue&#125; </span><br><span class=\"line\">    onChange=&#123;this.handleChange.bind(this)&#125; </span><br><span class=\"line\">    modules=&#123;modules&#125;</span><br><span class=\"line\">    className=&apos;qrill-main&apos;</span><br><span class=\"line\">    ref=&#123;(el) =&gt; this.quillRef = el&#125;</span><br><span class=\"line\">/&gt;</span><br></pre></td></tr></table></figure>\n<ul>\n<li>重难点在于富文本内的图像上传</li>\n</ul>\n<figure class=\"highlight plain\"><table><tr><td class=\"gutter\"><pre><span class=\"line\">1</span><br><span class=\"line\">2</span><br><span class=\"line\">3</span><br><span class=\"line\">4</span><br><span class=\"line\">5</span><br><span class=\"line\">6</span><br><span class=\"line\">7</span><br><span class=\"line\">8</span><br><span class=\"line\">9</span><br><span class=\"line\">10</span><br><span class=\"line\">11</span><br><span class=\"line\">12</span><br><span class=\"line\">13</span><br><span class=\"line\">14</span><br><span class=\"line\">15</span><br><span class=\"line\">16</span><br><span class=\"line\">17</span><br><span class=\"line\">18</span><br><span class=\"line\">19</span><br><span class=\"line\">20</span><br><span class=\"line\">21</span><br><span class=\"line\">22</span><br><span class=\"line\">23</span><br><span class=\"line\">24</span><br><span class=\"line\">25</span><br><span class=\"line\">26</span><br><span class=\"line\">27</span><br><span class=\"line\">28</span><br><span class=\"line\">29</span><br><span class=\"line\">30</span><br><span class=\"line\">31</span><br><span class=\"line\">32</span><br><span class=\"line\">33</span><br><span class=\"line\">34</span><br><span class=\"line\">35</span><br><span class=\"line\">36</span><br><span class=\"line\">37</span><br><span class=\"line\">38</span><br><span class=\"line\">39</span><br><span class=\"line\">40</span><br><span class=\"line\">41</span><br><span class=\"line\">42</span><br><span class=\"line\">43</span><br><span class=\"line\">44</span><br><span class=\"line\">45</span><br><span class=\"line\">46</span><br><span class=\"line\">47</span><br><span class=\"line\">48</span><br><span class=\"line\">49</span><br><span class=\"line\">50</span><br><span class=\"line\">51</span><br><span class=\"line\">52</span><br><span class=\"line\">53</span><br><span class=\"line\">54</span><br><span class=\"line\">55</span><br><span class=\"line\">56</span><br><span class=\"line\">57</span><br><span class=\"line\">58</span><br><span class=\"line\">59</span><br><span class=\"line\">60</span><br><span class=\"line\">61</span><br><span class=\"line\">62</span><br><span class=\"line\">63</span><br><span class=\"line\">64</span><br><span class=\"line\">65</span><br><span class=\"line\">66</span><br></pre></td><td class=\"code\"><pre><span class=\"line\"></span><br><span class=\"line\">// 触发上传</span><br><span class=\"line\">imageHandler(image, callback)&#123;</span><br><span class=\"line\">    const self = this;</span><br><span class=\"line\">    if(image)&#123;</span><br><span class=\"line\">        const input = document.createElement(&apos;input&apos;);</span><br><span class=\"line\">        input.setAttribute(&apos;type&apos;, &apos;file&apos;);</span><br><span class=\"line\">        input.click();</span><br><span class=\"line\"></span><br><span class=\"line\">        // Listen upload local image and save to server</span><br><span class=\"line\">        input.onchange = () =&gt; &#123;</span><br><span class=\"line\">            const file = input.files[0];</span><br><span class=\"line\"></span><br><span class=\"line\">            // file type is only image.</span><br><span class=\"line\">            let bool = _this.beforeUpload(file);</span><br><span class=\"line\"></span><br><span class=\"line\">            if(bool)&#123;</span><br><span class=\"line\">                _this.saveToServer(file);</span><br><span class=\"line\">            &#125;;</span><br><span class=\"line\">        &#125;;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\"></span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 上传到服务端</span><br><span class=\"line\">saveToServer(file)&#123;</span><br><span class=\"line\">    const self = this;</span><br><span class=\"line\">    http.postAsFormData(&apos;XXX&apos;,&#123;</span><br><span class=\"line\">        file : file</span><br><span class=\"line\">    &#125;).then((res) =&gt; &#123;</span><br><span class=\"line\">        if(res &amp;&amp; res.status === &apos;succeed&apos;)&#123;</span><br><span class=\"line\">            self.insertToEditor(res.uploadRsp.accessUrl)</span><br><span class=\"line\">        &#125; else&#123;</span><br><span class=\"line\"></span><br><span class=\"line\">        &#125;</span><br><span class=\"line\">    &#125;);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 替换文件</span><br><span class=\"line\">insertToEditor(url)&#123;</span><br><span class=\"line\">    const range = this.quillRef.getEditor().getSelection();</span><br><span class=\"line\">    this.quillRef.getEditor().insertEmbed(range.index, &apos;image&apos;, url);</span><br><span class=\"line\">&#125;</span><br><span class=\"line\"></span><br><span class=\"line\">// 图片校验</span><br><span class=\"line\">beforeUpload(file,allType = [&apos;jpg&apos;,&apos;png&apos;,&apos;jpeg&apos;],maxSize=5, type) &#123;</span><br><span class=\"line\">    let fileType = file.type;</span><br><span class=\"line\">    let &#123; name &#125; = file;</span><br><span class=\"line\">    if (!fileType) &#123;</span><br><span class=\"line\">        fileType = name.split(&apos;.&apos;).pop();</span><br><span class=\"line\">    &#125; else &#123;</span><br><span class=\"line\">        fileType = fileType.split(&apos;/&apos;)[1];</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    const isJPG = allType.indexOf(fileType) &gt; -1;</span><br><span class=\"line\">    if (!isJPG) &#123;</span><br><span class=\"line\">        message.error(&apos;请上传正确的格式！&apos;);</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    const isLt3M = file.size / 1024 / 1024 &lt; maxSize;</span><br><span class=\"line\">    if (!isLt3M &amp;&amp; isJPG) &#123;</span><br><span class=\"line\">        message.error(`上传图片必须小于$&#123;maxSize&#125;M!`);</span><br><span class=\"line\">        return false;</span><br><span class=\"line\">    &#125;</span><br><span class=\"line\">    let isSuccess = isJPG &amp;&amp; isLt3M;</span><br><span class=\"line\">    return  isSuccess;</span><br><span class=\"line\">&#125;</span><br></pre></td></tr></table></figure>","prev":{"title":"移动端图片上传-踩坑小记","slug":"移动端图片上传-踩坑小记"},"next":{"title":"Hello World","slug":"hello-world"},"link":"http://yoursite.com/post/React-quill-初体验/"}